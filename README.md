# TTS文本过滤插件

一个智能的AstrBot TTS文本过滤插件，支持前端配置界面，可过滤颜文字、特殊符号、网络用语等不适合TTS朗读的内容。

## ✨ 主要特性

- **颜文字过滤**: 自动移除 `(＾_＾)`, `(>_<)`, `o_o` 等颜文字
- **特殊符号清理**: 过滤 ★♪♥💖→ 等装饰性符号  
- **网络用语处理**: `233` → `哈哈哈`, `666` → `厉害`
- **重复字符压缩**: `哈哈哈哈哈` → `哈哈`
- **分离过滤模式**: 支持直接过滤（不朗读）和替换朗读两种模式
- **前端配置界面**: 通过AstrBot配置面板轻松设置
- **正则表达式支持**: 支持复杂的过滤模式
- **字数限制**: 可设置超过指定字数不进行TTS朗读
- **实时调整**: 配置修改后无需重启即可生效
- **详细日志**: 可开启调试模式查看详细过滤过程

## 🚀 安装使用

### 手动安装
1. 下载插件文件到AstrBot插件目录
2. 重启AstrBot或手动加载插件
3. 在配置面板中调整过滤规则

### 配置说明
插件支持以下配置项：

- **启用过滤**: 总开关，控制是否启用过滤功能
- **最大朗读字数**: 超过此字数将跳过TTS (0=无限制)
- **颜文字过滤规则**: 正则表达式列表，匹配需要过滤的颜文字
- **直接过滤词汇**: 完全不朗读的词汇列表 (如：orz, QAQ)
- **替换词汇配置**: 替换规则，格式为"原词|替换词" (如：233|哈哈哈)
- **特殊符号过滤**: 是否过滤装饰性符号和表情
- **重复字符处理**: 是否压缩重复字符 (如：哈哈哈哈 → 哈哈)
- **调试模式**: 是否输出详细的处理日志

#### 分离过滤和替换模式
- **直接过滤**: 词汇完全从TTS中移除，不朗读
- **替换朗读**: 词汇替换为更适合朗读的内容
- **前端配置**: 支持在AstrBot配置面板中直接编辑

## 🎮 使用命令

### 基本命令
- `/tts_filter_test [文本]` - 测试过滤效果
- `/tts_filter_stats` - 查看插件状态和配置信息
- `/tts_filter_reload` - 重新加载配置

### 使用示例
```
/tts_filter_test 你好(＾_＾)这是测试233哈哈哈哈♪

📝 原文 (15 字符):
你好(＾_＾)这是测试233哈哈哈哈♪

🔧 过滤后 (9 字符):
你好这是测试哈哈哈哈

📊 统计信息:
• 应用的过滤器: emoticon, replace:233->哈哈哈, special_chars
• 字符压缩率: 40.0%
• TTS状态: ✅ 可朗读
```

## 🔧 工作原理

### 过滤流程
```
LLM回复 → 文本过滤 → 字数检查 → TTS合成
           ↓
    应用所有过滤规则:
    1. 颜文字移除
    2. 过滤词汇移除  
    3. 词汇替换
    4. 特殊符号移除
    5. 重复字符压缩
    6. 空格清理
```

### 拦截时机
插件使用 `@filter.on_llm_response()` 在LLM响应阶段拦截文本，确保：
- 在TTS插件处理之前进行过滤
- 对所有TTS引擎都有效
- 不影响其他插件功能

## 📈 配置示例

```json
{
  "enabled": true,
  "max_length": 200,
  "emoticon_patterns": [
    "[（(][^（()]*[）)]",
    "[＞>][＿_][＜<]",
    "[＾^][＿_][＾^]"
  ],
  "filter_words": ["233", "666", "orz"],
  "replacement_rules": {
    "233": "哈哈哈",
    "666": "厉害"
  },
  "filter_special_chars": true,
  "filter_repeats": true,
  "max_repeat_count": 2,
  "debug_mode": false
}
```

## 🐛 故障排除

### 常见问题
1. **过滤不生效**: 检查插件是否启用，优先级是否足够高
2. **配置不保存**: 确认AstrBot版本支持插件配置面板
3. **正则表达式错误**: 检查配置中的正则表达式语法

### 调试方法
1. 开启调试模式查看详细日志
2. 使用测试命令验证过滤效果
3. 检查统计信息确认插件运行状态

## 🔄 版本历史

- **v0.2** - 分离过滤和替换功能，优化配置界面，移除数据持久化
- **v0.1** - 初始版本，基础过滤功能

## 📝 许可证

MIT License
