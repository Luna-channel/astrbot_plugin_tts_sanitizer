# TTSæ–‡æœ¬è¿‡æ»¤æ’ä»¶

ä¸€ä¸ªæ™ºèƒ½çš„AstrBot TTSæ–‡æœ¬è¿‡æ»¤æ’ä»¶ï¼Œä¸“é—¨ç”¨äºŽæ¸…ç†ä¸é€‚åˆè¯­éŸ³æœ—è¯»çš„å†…å®¹ï¼Œè®©TTSè¾“å‡ºæ›´åŠ è‡ªç„¶æµç•…ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **ðŸŽ­ é¢œæ–‡å­—è¿‡æ»¤**: è‡ªåŠ¨ç§»é™¤ `(ï¼¾_ï¼¾)`, `(>_<)`, `o_o` ç­‰é¢œæ–‡å­—
- **ðŸŽ¨ ç‰¹æ®Šç¬¦å·æ¸…ç†**: è¿‡æ»¤ â˜…â™ªâ™¥ðŸ’–â†’ ç­‰è£…é¥°æ€§ç¬¦å·å’Œè¡¨æƒ…ç¬¦å·
- **ðŸ”„ æ™ºèƒ½æ›¿æ¢**: `233` â†’ `å“ˆå“ˆå“ˆ`, `666` â†’ `åŽ‰å®³`, `555` â†’ `å‘œå‘œå‘œ`
- **ðŸ—‘ï¸ ç›´æŽ¥è¿‡æ»¤**: å®Œå…¨ç§»é™¤ `orz`, `QAQ`, `TAT` ç­‰ä¸é€‚åˆæœ—è¯»çš„è¯æ±‡
- **ðŸ“ é‡å¤å­—ç¬¦åŽ‹ç¼©**: `å“ˆå“ˆå“ˆå“ˆå“ˆ` â†’ `å“ˆå“ˆ` (å¯é…ç½®ä¿ç•™æ•°é‡)
- **ðŸ“ å­—æ•°é™åˆ¶**: è¶…è¿‡æŒ‡å®šå­—æ•°è‡ªåŠ¨è·³è¿‡TTSæœ—è¯»
- **âš™ï¸ çµæ´»é…ç½®**: æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™
- **ðŸ”§ å®žæ—¶è°ƒè¯•**: å¯å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†è¿‡æ»¤è¿‡ç¨‹
- **ðŸ“Š çŠ¶æ€ç›‘æŽ§**: æä¾›æµ‹è¯•å‘½ä»¤å’Œç»Ÿè®¡ä¿¡æ¯

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…æ–¹æ³•
1. å°†æ’ä»¶æ–‡ä»¶æ”¾å…¥AstrBotçš„æ’ä»¶ç›®å½•
2. é‡å¯AstrBotæˆ–ä½¿ç”¨æ’ä»¶ç®¡ç†åŠŸèƒ½åŠ è½½
3. æ’ä»¶ä¼šè‡ªåŠ¨å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯å¼€å§‹å·¥ä½œ

### åŸºæœ¬ä½¿ç”¨
æ’ä»¶å®‰è£…åŽä¼šè‡ªåŠ¨å·¥ä½œï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å½“æœºå™¨äººå›žå¤åŒ…å«ä¸é€‚åˆTTSçš„å†…å®¹æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œè¿‡æ»¤ï¼š

**åŽŸå§‹å›žå¤**: `ä½ å¥½(ï¼¾_ï¼¾)è¿™æ˜¯æµ‹è¯•233å“ˆå“ˆå“ˆå“ˆâ™ª`  
**è¿‡æ»¤åŽ**: `ä½ å¥½è¿™æ˜¯æµ‹è¯•å“ˆå“ˆå“ˆå“ˆ`

## ðŸŽ® å‘½ä»¤ä½¿ç”¨

### æµ‹è¯•å‘½ä»¤
```
/tts_filter_test [æµ‹è¯•æ–‡æœ¬]
```
æµ‹è¯•è¿‡æ»¤æ•ˆæžœï¼ŒæŸ¥çœ‹å¤„ç†å‰åŽçš„å¯¹æ¯”ã€‚

**ç¤ºä¾‹**:
```
/tts_filter_test ä½ å¥½(ï¼¾_ï¼¾)è¿™æ˜¯æµ‹è¯•233å“ˆå“ˆå“ˆå“ˆâ™ª

ðŸ“ åŽŸæ–‡ (15 å­—ç¬¦):
ä½ å¥½(ï¼¾_ï¼¾)è¿™æ˜¯æµ‹è¯•233å“ˆå“ˆå“ˆå“ˆâ™ª

ðŸ”§ è¿‡æ»¤åŽ (9 å­—ç¬¦):
ä½ å¥½è¿™æ˜¯æµ‹è¯•å“ˆå“ˆå“ˆå“ˆ

âš™ï¸ å½“å‰é…ç½®:
â€¢ ç›´æŽ¥è¿‡æ»¤: orz, QAQ, TATç­‰
â€¢ æ›¿æ¢è§„åˆ™: 233â†’å“ˆå“ˆå“ˆ, 666â†’åŽ‰å®³ç­‰

ðŸ“Š å¤„ç†ç»“æžœ:
â€¢ å­—ç¬¦åŽ‹ç¼©çŽ‡: 40.0%
â€¢ TTSçŠ¶æ€: âœ… å¯æœ—è¯»
```

### çŠ¶æ€æŸ¥çœ‹
```
/tts_filter_stats
```
æŸ¥çœ‹æ’ä»¶è¿è¡ŒçŠ¶æ€å’Œå½“å‰é…ç½®ä¿¡æ¯ã€‚

### é…ç½®é‡è½½
```
/tts_filter_reload
```
é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆã€‚

## âš™ï¸ é…ç½®è¯´æ˜Ž

æ’ä»¶æ”¯æŒé€šè¿‡AstrBoté…ç½®é¢æ¿è¿›è¡Œè®¾ç½®ï¼Œä¸»è¦é…ç½®é¡¹åŒ…æ‹¬ï¼š

### åŸºç¡€è®¾ç½®
- **å¯ç”¨è¿‡æ»¤** (`enabled`): æ€»å¼€å…³ï¼ŒæŽ§åˆ¶æ˜¯å¦å¯ç”¨è¿‡æ»¤åŠŸèƒ½
- **æœ€å¤§æœ—è¯»å­—æ•°** (`max_length`): è¶…è¿‡æ­¤å­—æ•°å°†è·³è¿‡TTS (0=æ— é™åˆ¶)
- **è°ƒè¯•æ¨¡å¼** (`debug_mode`): æ˜¯å¦è¾“å‡ºè¯¦ç»†çš„å¤„ç†æ—¥å¿—

### è¿‡æ»¤è§„åˆ™
- **é¢œæ–‡å­—è¿‡æ»¤è§„åˆ™** (`emoticon_patterns`): æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨ï¼ŒåŒ¹é…éœ€è¦è¿‡æ»¤çš„é¢œæ–‡å­—
- **ç›´æŽ¥è¿‡æ»¤è¯æ±‡** (`filter_words`): å®Œå…¨ä¸æœ—è¯»çš„è¯æ±‡åˆ—è¡¨
- **æ›¿æ¢è¯æ±‡é…ç½®** (`replacement_words`): æ›¿æ¢è§„åˆ™ï¼Œæ ¼å¼ä¸º"åŽŸè¯|æ›¿æ¢è¯"
- **ç‰¹æ®Šç¬¦å·è¿‡æ»¤** (`filter_special_chars`): æ˜¯å¦è¿‡æ»¤è£…é¥°æ€§ç¬¦å·å’Œè¡¨æƒ…
- **é‡å¤å­—ç¬¦å¤„ç†** (`filter_repeats`): æ˜¯å¦åŽ‹ç¼©é‡å¤å­—ç¬¦
- **æœ€å¤§é‡å¤æ•°é‡** (`max_repeat_count`): ä¿ç•™çš„æœ€å¤§é‡å¤å­—ç¬¦æ•°é‡

### é»˜è®¤é…ç½®
```json
{
  "enabled": true,
  "max_length": 200,
  "emoticon_patterns": [
    "[ï¼ˆ(][^ï¼ˆ()]*[ï¼‰)]",
    "[ï¼ž>][ï¼¿_][ï¼œ<]",
    "[ï¼¾^][ï¼¿_][ï¼¾^]",
    "[oO][ï¼¿_][oO]",
    "[xX][ï¼¿_][xX]",
    "[ï¼-][ï¼¿_][ï¼-]",
    "[ï¼ˆ(][ï¼›;][ï¼¿_][ï¼›;][ï¼‰)]"
  ],
  "filter_words": ["orz", "OTZ", "QAQ", "QWQ", "TAT", "TUT"],
  "replacement_words": [
    "233|å“ˆå“ˆå“ˆ",
    "666|åŽ‰å®³", 
    "999|å¾ˆæ£’",
    "6|åŽ‰å®³",
    "555|å‘œå‘œå‘œ"
  ],
  "filter_special_chars": true,
  "special_char_patterns": [
    "[â˜…â˜†â™ªâ™«â™¬â™©â™¡â™¥â¤ï¸ðŸ’–ðŸ’•ðŸ’—ðŸ’“ðŸ’ðŸ’ŸðŸ’œðŸ’›ðŸ’šðŸ’™ðŸ§¡ðŸ¤ðŸ–¤ðŸ¤ŽðŸ’”â£ï¸ðŸ’‹]",
    "[â†’â†â†‘â†“â†–â†—â†˜â†™â†”â†•â†ºâ†»]"
  ],
  "filter_repeats": true,
  "max_repeat_count": 2,
  "debug_mode": false
}
```

## ðŸ”§ å·¥ä½œåŽŸç†

### è¿‡æ»¤æµç¨‹
```
LLMå›žå¤ â†’ æ–‡æœ¬è¿‡æ»¤ â†’ å­—æ•°æ£€æŸ¥ â†’ TTSåˆæˆ
           â†“
    åº”ç”¨æ‰€æœ‰è¿‡æ»¤è§„åˆ™:
    1. é¢œæ–‡å­—ç§»é™¤ (æ­£åˆ™åŒ¹é…)
    2. ç›´æŽ¥è¿‡æ»¤è¯æ±‡ç§»é™¤
    3. è¯æ±‡æ›¿æ¢ (ç½‘ç»œç”¨è¯­è½¬æ¢)
    4. ç‰¹æ®Šç¬¦å·ç§»é™¤ (è¡¨æƒ…ç¬¦å·ç­‰)
    5. é‡å¤å­—ç¬¦åŽ‹ç¼©
    6. å¤šä½™ç©ºæ ¼æ¸…ç†
```

### æ‹¦æˆªæœºåˆ¶
- ä½¿ç”¨ `@filter.on_decorating_result()` åœ¨TTSæ’ä»¶å¤„ç†å‰æ‹¦æˆª
- ä¼˜å…ˆçº§è®¾ç½®ä¸º -1001ï¼Œç¡®ä¿åœ¨TTSæ’ä»¶ä¹‹å‰æ‰§è¡Œ
- åªå¯¹Plainæ–‡æœ¬ç»„ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œä¸å½±å“å…¶ä»–æ¶ˆæ¯ç»„ä»¶
- è¿‡æ»¤åŽç«‹å³æ¢å¤åŽŸå§‹æ–‡æœ¬ï¼Œç¡®ä¿æ˜¾ç¤ºå†…å®¹ä¸å˜

### æ™ºèƒ½å¤„ç†
- **åˆ†ç¦»æ¨¡å¼**: æ”¯æŒç›´æŽ¥è¿‡æ»¤ï¼ˆå®Œå…¨ç§»é™¤ï¼‰å’Œæ›¿æ¢æœ—è¯»ä¸¤ç§æ¨¡å¼
- **å­—æ•°æŽ§åˆ¶**: è¶…è¿‡é™åˆ¶å­—æ•°çš„æ–‡æœ¬è‡ªåŠ¨è·³è¿‡TTS
- **æ€§èƒ½ä¼˜åŒ–**: å¤„ç†æ—¶é—´è¶…è¿‡0.1ç§’ä¼šè®°å½•è­¦å‘Šæ—¥å¿—
- **é”™è¯¯å¤„ç†**: é…ç½®ç¼–è¯‘å¤±è´¥æ—¶è‡ªåŠ¨å›žé€€åˆ°é»˜è®¤é…ç½®

## ðŸ› æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

**Q: è¿‡æ»¤ä¸ç”Ÿæ•ˆæ€Žä¹ˆåŠžï¼Ÿ**
A: æ£€æŸ¥æ’ä»¶æ˜¯å¦å¯ç”¨ï¼Œä½¿ç”¨ `/tts_filter_stats` æŸ¥çœ‹çŠ¶æ€ï¼Œç¡®è®¤é…ç½®æ­£ç¡®ã€‚

**Q: é…ç½®ä¿®æ”¹åŽä¸ç”Ÿæ•ˆï¼Ÿ**
A: ä½¿ç”¨ `/tts_filter_reload` é‡æ–°åŠ è½½é…ç½®ï¼Œæˆ–é‡å¯AstrBotã€‚

**Q: æ­£åˆ™è¡¨è¾¾å¼æŠ¥é”™ï¼Ÿ**
A: æ£€æŸ¥é…ç½®ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨åœ¨çº¿æ­£åˆ™æµ‹è¯•å·¥å…·éªŒè¯ã€‚

### è°ƒè¯•æ–¹æ³•
1. å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. ä½¿ç”¨æµ‹è¯•å‘½ä»¤éªŒè¯è¿‡æ»¤æ•ˆæžœ
3. æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯ç¡®è®¤æ’ä»¶è¿è¡ŒçŠ¶æ€
4. æŸ¥çœ‹AstrBotæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **é«˜æ•ˆæ­£åˆ™**: ä½¿ç”¨ç¼–è¯‘åŽçš„æ­£åˆ™è¡¨è¾¾å¼æé«˜åŒ¹é…é€Ÿåº¦
- **æ™ºèƒ½è·³è¿‡**: ç©ºæ–‡æœ¬æˆ–è¶…é•¿æ–‡æœ¬ç›´æŽ¥è·³è¿‡å¤„ç†
- **å†…å­˜ä¼˜åŒ–**: åŠæ—¶æ¸…ç†ä¸´æ—¶å˜é‡ï¼Œé¿å…å†…å­˜æ³„æ¼
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨å¼‚æ­¥æ–¹æ³•ï¼Œä¸é˜»å¡žä¸»çº¿ç¨‹

## ðŸ”„ ç‰ˆæœ¬åŽ†å²

- **v0.2** (å½“å‰ç‰ˆæœ¬)
  - åˆ†ç¦»è¿‡æ»¤å’Œæ›¿æ¢åŠŸèƒ½
  - ä¼˜åŒ–é…ç½®ç•Œé¢å’Œé”™è¯¯å¤„ç†
  - ç§»é™¤æ•°æ®æŒä¹…åŒ–ï¼Œç®€åŒ–æž¶æž„
  - æ·»åŠ è¯¦ç»†çš„è°ƒè¯•å’Œç»Ÿè®¡åŠŸèƒ½
  - æ”¹è¿›æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ€§èƒ½

- **v0.1** 
  - åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€è¿‡æ»¤åŠŸèƒ½

## ðŸ“ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªæ’ä»¶ï¼

## ðŸ“ž æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼èŽ·å–å¸®åŠ©ï¼š
- æäº¤GitHub Issue
- æŸ¥çœ‹AstrBotå®˜æ–¹æ–‡æ¡£
- ä½¿ç”¨æ’ä»¶å†…ç½®çš„æµ‹è¯•å’Œç»Ÿè®¡å‘½ä»¤
